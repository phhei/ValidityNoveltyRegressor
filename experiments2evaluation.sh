#!/bin/bash
set -e

# Table 2
# sbatch wrapper-cpu.sh ".out/V0.4.0/roberta-large/Train + annotated_train/750 samples/try-1/repetition-8" ".out/V0.4.0/roberta-large/Train + annotated_train_CW/750 samples/try-0/repetition-1" ".out/V0.4.2/roberta-large/Train + annotated_train/751 samples/try-1/repetition-0/_reload/roberta-large-0" ".out/V0.4.2/roberta-large/Train + annotated_train/751 samples/try-1/repetition-5" ".out/V0.4.2/roberta-large/Train + annotated_train_CW/751 samples/try-0/repetition-6" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/34262 samples/try-1/repetition-1/_reload/roberta-large-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/34262 samples/try-1/repetition-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW/34262 samples/try-0/repetition-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/33000 samples/try-4/repetition-1/_reload/roberta-large-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/33000 samples/try-4/repetition-2" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW/34262 samples/try-0/repetition-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW/33000 samples/try-6/repetition-2" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/35012 samples/try-0/repetition-0/_reload/roberta-large-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/35012 samples/try-0/repetition-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW + annotated_train_CW/35012 samples/try-0/repetition-2" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/34000 samples/try-3/repetition-4/_reload/roberta-large-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/34000 samples/try-3/repetition-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW + annotated_train_CW/34000 samples/try-6/repetition-0"
# Table 3
# sbatch wrapper-cpu.sh ".out/V0.4.2/roberta-large/Train + annotated_train_CW/100 samples/try-0/repetition-3" ".out/V0.4.2/roberta-large/Train + annotated_train_CW/1000 samples/try-0/repetition-8" ".out/V0.4.0/roberta-large/Train + annotated_train_CW/10000 samples/try-0/repetition-5" ".out/V0.4.2/roberta-large/Train + annotated_train_CW/100000 samples/try-0/repetition-1" ".out/V0.4.0/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/100 samples/try-0/repetition-5" ".out/V0.4.0/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/1000 samples/try-0/repetition-8" ".out/V0.4.0/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/10000 samples/try-0/repetition-4" ".out/V0.4.1/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays/100000 samples/try-0/repetition-0" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW/100 samples/try-2/repetition-10" ".out/V0.4.1/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW/1000 samples/try-0/repetition-4" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW/10000 samples/try-3/repetition-1" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW/100000 samples/try-0/repetition-2" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/100 samples/try-0/repetition-11/_reload/roberta-large-0" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/100 samples/try-0/repetition-0" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/1000 samples/try-0/repetition-3/_reload/roberta-large-0" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/1000 samples/try-0/repetition-10" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/10000 samples/try-0/repetition-1/_reload/roberta-large-0" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/10000 samples/try-0/repetition-0" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/100000 samples/try-0/repetition-0/_reload/roberta-large-1" ".out/V0.4.1_/roberta_large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality _deduplicated_ + Student-essays + annotated_train/100000 samples/try-0/repetition-1" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW + annotated_train_CW/100 samples/try-0/repetition-8" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW + annotated_train_CW/1000 samples/try-0/repetition-8" ".out/V0.4.1/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW + annotated_train_CW/10000 samples/try-2/repetition-3" ".out/V0.4.2/roberta-large/Train + ExplaGraphs_train + ExplaGraphs_dev + IBM-Arg-Quality_CW _deduplicated_ + Student-essays_CW + annotated_train_CW/100000 samples/try-0/repetition-0"

echo "Received $# for the python script"

export PATH="$HOME/.pyenv/bin:$PATH"
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init --path)"
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"
pyenv global 3.9.5

python -m pip install -r requirements.txt

for model in "$@"
do
  echo "Process $model"
  # Step 1
  mkdir -p "$model"/_test
  cp "ArgumentData/ValidityNoveltySharedTask/TaskA_test.csv" "$model"/_test
  python Inference.py "$model" "$model"/_test/TaskA_test.csv  156 --batch_size 8
  # Step 2 - Evaluator from https://github.com/phhei/ArgsValidNovel/blob/gh-pages/Evaluation/Evaluator.py
  find "$model"/_test -name "TaskA_test_*.csv" -exec  python Evaluator.py A "{}" \;
done